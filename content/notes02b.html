---
title: "Week 2-B Lecture Notes: List Columns"
subtitle: "**Development** Version 0.9000"
output: html_document
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>Tuesday, Nov 03 - Thursday, Nov 05</p>
<div id="learning-objectives" class="section level2">
<h2>Learning Objectives</h2>
<p>Did you know that a column of a tibble can contain a list – not just a vector? This week explores when such a thing would come in handy, and how to work with list columns.</p>
<p>From this week, students are anticipated to be able to:</p>
<ul>
<li>Use the <code>map</code> family of functions from the purrr package to iteratively apply a function.</li>
<li>Create and operate on list columns in a tibble using <code>nest()</code>, <code>unnest()</code>, and the <code>map()</code> family of functions.</li>
<li>Define functions on-the-fly within a <code>map</code> function using shortcuts.</li>
<li>Apply list columns to cases in data analysis: columns of models, columns of nested lists (JSON-style data), and operating on entire groups within a tibble.</li>
</ul>
</div>
<div id="resources" class="section level2">
<h2>Resources</h2>
<p>These resources are meant to be <em>paired</em> with this week, not necessarily digested <em>before</em> class.</p>
<ul>
<li>STAT 545 Episode 2-B (released later in the week)</li>
<li><a href="https://r4ds.had.co.nz/iteration.html">R4DS Chapter 21: Iteration</a> for purrr
<ul>
<li>21.1 for an intro</li>
<li>21.5 for the <code>map</code> family of functions</li>
<li>The intro of 21.7 for the <code>map2</code> and <code>pmap</code> families.</li>
</ul></li>
<li><a href="https://jennybc.github.io/purrr-tutorial/ls13_list-columns.html">“List Columns”</a> from <a href="https://jennybc.github.io/purrr-tutorial/index.html">Jenny’s purrr tutorial</a></li>
<li><a href="https://tidyr.tidyverse.org/articles/nest.html">“Nested data” article</a> on tidyr’s website.</li>
</ul>
<p>By the way, why use the <code>map</code> functions over <code>for</code> loops? Aside from the what’s said at <a href="https://r4ds.had.co.nz/iteration.html#for-loops-vs.-functionals">R4DS’s Section 21.4</a>, the <code>map</code> family encourages the input vector(s) and function to be carefully defined first, whereas a <code>for</code> loop is more of a free-for-all. Using <code>map()</code> is also more readable, is pipe-friendly, and jibes well with list columns in tibbles.</p>
</div>
<div id="demonstration" class="section level2">
<h2>Demonstration</h2>
<p>Here are some additional exercises that we may cover in class.</p>
<div id="demo-1-map2" class="section level3">
<h3>Demo 1: <code>map2</code></h3>
<p>Using the <code>palmerpenguins::penguins</code> tibble:</p>
<ol style="list-style-type: decimal">
<li>Make a Normal distribution using <code>distplyr::dst_norm()</code> for the body mass of each species, using estimates taken from <code>mean()</code> and <code>var()</code>. Title the column <code>distribution</code>.</li>
<li>Calculate the 0.975-quantile from each distribution using <code>distplyr::eval_quantile()</code>. Try this by making a new column of distributions, and by not.</li>
</ol>
<p>Starter code:</p>
<pre><code>(demo1 &lt;- penguins %&gt;% 
  group_by(species) %&gt;% 
  summarise(mean = mean(body_mass_g, na.rm = TRUE),
            var  = var(body_mass_g, na.rm = TRUE)))</code></pre>
<p>Answer:</p>
</div>
</div>
<div id="a-tibble-3-x-3" class="section level1">
<h1>A tibble: 3 x 3</h1>
<p>species mean var
<fct> <dbl> <dbl>
1 Adelie 3701. 210283.
2 Chinstrap 3733. 147713.
3 Gentoo 5076. 254133.</p>
<div id="demo-2-unnest" class="section level3">
<h3>Demo 2: <code>unnest()</code></h3>
<p><code>unnest()</code> need not always be paired with <code>nest()</code>. For the above distributions, evaluate the 0.25, 0.50, and 0.75 quantiles using the <code>distplyr::enframe_quantile()</code> function.</p>
<p>Starter code:</p>
<pre><code>demo1 %&gt;% 
  mutate(quantiles = FILL_THIS_IN)</code></pre>
<p>Answer</p>
<pre><code>## Error: Problem with `mutate()` input `quantiles`.
## x object &#39;FILL_THIS_IN&#39; not found
## ℹ Input `quantiles` is `FILL_THIS_IN`.</code></pre>
</div>
</div>
