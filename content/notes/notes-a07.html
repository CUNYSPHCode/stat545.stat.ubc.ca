---
title: "Lecture Notes: Plotting Part II"
output: html_document
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<div id="demo-1" class="section level3">
<h3>Demo 1</h3>
<p>From last class:</p>
<blockquote>
<p>Compute a weighted mean of life expectancy for different years, weighting by population.</p>
</blockquote>
<p>Plot that global average life expectancy over time.</p>
<pre class="r"><code>gapminder %&gt;% 
  group_by(year) %&gt;% 
  summarise(wmean = sum(lifeExp * pop) / sum(pop)) %&gt;% 
  ggplot(aes(year, wmean)) +
  geom_line()</code></pre>
<pre><code>## Error in gapminder %&gt;% group_by(year) %&gt;% summarise(wmean = sum(lifeExp * : could not find function &quot;%&gt;%&quot;</code></pre>
</div>
<div id="demo-2" class="section level3">
<h3>Demo 2</h3>
<p>From last class:</p>
<blockquote>
<p>For each continent and year, how many countries have a “low” life expectancy? Let’s say life expectancy is “low” if it’s less than the median most recent life expectancy for each continent.</p>
</blockquote>
<p>Plot the number of “low life expectancy” countries over time for each continent.</p>
<pre class="r"><code>gapminder %&gt;% 
  group_by(continent) %&gt;% 
  mutate(median = median(lifeExp[year == 2007])) %&gt;% 
  filter(lifeExp &lt; median) %&gt;% 
  count(continent, year) %&gt;% 
  ggplot(aes(year, n)) +
  geom_line(aes(colour = continent)) +
  ylab(&quot;# of countries with low lifeExp&quot;) +
  labs(title = &quot;Evolution over time&quot;) +
  scale_x_continuous(&quot;&quot;) +
  scale_colour_discrete(&quot;&quot;) +
  theme_minimal() +
  theme(panel.grid = element_blank())</code></pre>
<pre><code>## Error in gapminder %&gt;% group_by(continent) %&gt;% mutate(median = median(lifeExp[year == : could not find function &quot;%&gt;%&quot;</code></pre>
</div>
<div id="demo-3" class="section level3">
<h3>Demo 3</h3>
<p><strong>(a)</strong></p>
<p>Plot GDP per capita over time, identifying each continent.</p>
<pre class="r"><code>p3 &lt;- ggplot(gapminder, aes(year, gdpPercap)) +
  geom_line(aes(group = country, colour = continent), alpha = 1/3) +
  facet_wrap(~ continent) +
  scale_y_log10(labels = scales::dollar_format()) +
  guides(colour = FALSE)</code></pre>
<pre><code>## Error in ggplot(gapminder, aes(year, gdpPercap)): could not find function &quot;ggplot&quot;</code></pre>
<pre class="r"><code>p3</code></pre>
<pre><code>## Error in eval(expr, envir, enclos): object &#39;p3&#39; not found</code></pre>
<p><strong>(b)</strong></p>
<p>From last class Demo 3:</p>
<blockquote>
<p>Get the maximum and minimum <code>gdpPercap</code> for all continents.</p>
</blockquote>
<p>We’ll also add <em>for each year</em>. Today: modify plot (a) above so that the lines for each continent are contained within a band.</p>
<pre class="r"><code>gapminder %&gt;% 
  group_by(continent, year) %&gt;% 
  mutate(max = max(gdpPercap),
            min = min(gdpPercap)) %&gt;% 
  ggplot(aes(year, (gdpPercap))) +
  geom_ribbon(aes(ymin = min, ymax = max), alpha = 0.5, fill = &quot;gray&quot;) +
  geom_line(aes(group = country, colour = continent), alpha = 1/3) +
  # geom_ribbon(aes(ymin = quantile(gdpPercap, probs = 0.25),
  #                 ymax = quantile(gdpPercap, probs = 0.75),
  #                 group = year)) +
  facet_wrap( ~ continent) +
  scale_y_log10(labels = scales::dollar_format()) +
  guides(colour = FALSE) +
  theme_bw()</code></pre>
<pre><code>## Error in gapminder %&gt;% group_by(continent, year) %&gt;% mutate(max = max(gdpPercap), : could not find function &quot;%&gt;%&quot;</code></pre>
</div>
<div id="demo-4" class="section level3">
<h3>Demo 4</h3>
<p>From last class:</p>
<blockquote>
<p>Filter gapminder to all entries that have experienced a drop in life expectancy. Hint: <code>dplyr::lag()</code>.</p>
</blockquote>
<p>Today: Was a drop in life expectancy just as likely for any year, or were some years more prone to see a drop than others? Is this true for all continents?</p>
<pre class="r"><code>gapminder %&gt;% 
  group_by(country) %&gt;% 
  arrange(year) %&gt;% 
  mutate(inc = lifeExp - lag(lifeExp)) %&gt;% 
  filter(inc &lt; 0) %&gt;% 
  ggplot(aes(year)) +
  geom_bar()</code></pre>
<pre><code>## Error in gapminder %&gt;% group_by(country) %&gt;% arrange(year) %&gt;% mutate(inc = lifeExp - : could not find function &quot;%&gt;%&quot;</code></pre>
</div>
<div id="demo-5" class="section level3">
<h3>Demo 5</h3>
<p>How has the distribution of GDP per capita changed over time for each continent?</p>
<p>(Breakout rooms?)</p>
<pre class="r"><code>gapminder %&gt;% 
  filter(continent != &quot;Oceania&quot;) %&gt;% 
  ggplot(aes(gdpPercap, factor(year))) +
  ggridges::geom_density_ridges(aes(fill = continent), alpha = 1/3) +
  scale_x_log10(&quot;GDP per capita&quot;, labels = scales::dollar_format()) +
  ylab(&quot;Year&quot;) +
  theme_minimal() +
  scale_fill_discrete(&quot;&quot;)</code></pre>
<pre><code>## Error in gapminder %&gt;% filter(continent != &quot;Oceania&quot;) %&gt;% ggplot(aes(gdpPercap, : could not find function &quot;%&gt;%&quot;</code></pre>
</div>
<div id="effective-vis" class="section level3">
<h3>Effective Vis</h3>
<p>Let’s go through <a href="https://vincenzocoia.com/communicating_data/#28">Principles of Figure Design</a> slides, modelling Part II of <a href="https://clauswilke.com/dataviz/">Claus Wilke’s vis book</a>.</p>
</div>
<div id="demo-6" class="section level3">
<h3>Demo 6</h3>
<p>The following mock dataset marks the (x,y) position of a caribou at four time points.</p>
<pre><code>tribble(
  ~time, ~x, ~y,
  1, 0.3, 0.3,
  2, 0.8, 0.7,
  3, 0.5, 0.9,
  4, 0.4, 0.5
) %&gt;% 
  ggplot(aes(x, y)) + 
  geom_line()</code></pre>
<ul>
<li>Fix the plot below so that it shows the path of the caribou.</li>
<li>Add an arrow with <code>arrow = arrow()</code>.</li>
<li>Add the <code>time</code> label with <code>geom_text()</code>.</li>
</ul>
<pre class="r"><code>tribble(
  ~time, ~x, ~y,
  1, 0.3, 0.3,
  2, 0.8, 0.7,
  3, 0.5, 0.9,
  4, 0.4, 0.5
) %&gt;% 
  ggplot(aes(x, y)) + 
  geom_path(arrow = arrow()) +
  geom_text(aes(label = time), nudge_x = 0.02) +
  theme_void()</code></pre>
<pre><code>## Error in tribble(~time, ~x, ~y, 1, 0.3, 0.3, 2, 0.8, 0.7, 3, 0.5, 0.9, : could not find function &quot;%&gt;%&quot;</code></pre>
</div>
<div id="demo-7" class="section level3">
<h3>Demo 7</h3>
<ul>
<li>Change the following plot so that it shows <em>proportion</em> on the y-axis, not count.</li>
<li>Change the x-axis so that it doesn’t appear to be continuous.</li>
<li>Put the bars for transmission side-by-side with their own colour.</li>
<li>Capitalize the legend title.</li>
</ul>
<pre><code>mtcars %&gt;% 
  mutate(transmission = if_else(am == 0, &quot;automatic&quot;, &quot;manual&quot;)) %&gt;% 
  ggplot(aes(cyl)) +
  geom_bar(aes(colour = transmission))</code></pre>
<pre class="r"><code>mtcars %&gt;% 
  mutate(transmission = if_else(am == 0, &quot;automatic&quot;, &quot;manual&quot;)) %&gt;% 
  ggplot(aes(factor(cyl))) +
  geom_bar(aes(y = ..prop.., fill = transmission, group = transmission), 
           position = &quot;dodge&quot;) +
  scale_fill_discrete(&quot;Transmission&quot;) +
  labs(y = &quot;Proportion&quot;, x = &quot;Cylinders&quot;) +
  theme_minimal()</code></pre>
<pre><code>## Error in mtcars %&gt;% mutate(transmission = if_else(am == 0, &quot;automatic&quot;, : could not find function &quot;%&gt;%&quot;</code></pre>
</div>
<div id="demo-8" class="section level3">
<h3>Demo 8</h3>
<p>Here’s the number of people having a certain hair colour from a sample of 592 people:</p>
<pre class="r"><code>(hair &lt;- as_tibble(HairEyeColor) %&gt;% 
  count(Hair, wt = n))</code></pre>
<pre><code>## Error in as_tibble(HairEyeColor) %&gt;% count(Hair, wt = n): could not find function &quot;%&gt;%&quot;</code></pre>
<p>Fix the following bar plot so that it shows these counts.</p>
<pre><code>ggplot(hair, aes(Hair, n)) +
  geom_bar()</code></pre>
<pre class="r"><code>ggplot(hair, aes(Hair, n)) +
  geom_col()</code></pre>
<pre><code>## Error in ggplot(hair, aes(Hair, n)): could not find function &quot;ggplot&quot;</code></pre>
</div>
<div id="demo-9" class="section level3">
<h3>Demo 9</h3>
<p>Here’s the number of people having a certain hair and eye colour from a sample of 592 people:</p>
<pre class="r"><code>(hair_eye &lt;- as_tibble(HairEyeColor) %&gt;% 
  count(Hair, Eye, wt = n))</code></pre>
<pre><code>## Error in as_tibble(HairEyeColor) %&gt;% count(Hair, Eye, wt = n): could not find function &quot;%&gt;%&quot;</code></pre>
</div>
<div id="demo-10" class="section level3">
<h3>Demo 10</h3>
<p>Fix the following plot so that it shows a filled-in square for each combination.</p>
<pre><code>ggplot(hair_eye, aes(Hair, Eye)) +
  geom_point(aes(colour = n))</code></pre>
<pre class="r"><code>ggplot(hair_eye, aes(Hair, Eye)) +
  geom_bin2d(aes(fill = n)) +
  theme_minimal()</code></pre>
<pre><code>## Error in ggplot(hair_eye, aes(Hair, Eye)): could not find function &quot;ggplot&quot;</code></pre>
</div>
